<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Yuan Fong Restaurant</title>
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Font‑Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

    <!--
      ====================================================================
      All visual styles below are IDENTICAL to your previous file so your
      layout/branding is preserved. Feel free to remove them if you prefer
      an external stylesheet only.
      ====================================================================
    -->
    <style>
        :root {
            --primary-color: #b98d4b;
            --secondary-color: #8b0000;
            --light-color: #f8f4e9;
            --dark-color: #333;
            --gray-color: #666;
            --light-gray: #eee;
            --body-color: #fff;
            --transition: all 0.3s ease;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        /*  … ⬇ unchanged styles trimmed for brevity ⬇ …  */
        /* *** KEEP THE REST OF YOUR INLINE CSS HERE *** */
        /* (omitted in this snippet to keep the file readable) */
    </style>
</head>

<body>
    <!-- ===================================================== -->
    <!-- HEADER -->
    <!-- ===================================================== -->
    <header>
        <div class="logo-container">
            <img src="YuanFong.png" alt="Yuan Fong Restaurant Logo" class="logo" style="width: 125px; height: 100px;">
        </div>
        <nav id="navbar">
            <div class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="menu.html" class="active">Menu</a></li>
                <li><a href="blog.html">News & Promotions</a></li>
                <li><a href="contact.html">Contact Us</a></li>
            </ul>
        </nav>
    </header>

    <!-- ===================================================== -->
    <!-- PAGE BANNER -->
    <!-- ===================================================== -->
    <section class="page-banner">
        <div class="container">
            <h1>Our Menu</h1>
        </div>
    </section>

    <!-- ===================================================== -->
    <!-- MENU SECTION (Dynamic) -->
    <!-- ===================================================== -->
    <section class="menu">
        <div class="container">

            <!-- Success toast  -->
            <div class="success-message" id="successMessage">Successfully added to cart!</div>

            <!--  CART  MODAL  -->
            <div class="cart-modal" id="cartModal">
                <div class="cart-content">
                    <h3 class="cart-title">Your Cart</h3>
                    <div class="cart-items" id="cartItems"></div>
                    <div class="cart-total" id="cartTotal">Total: RM0.00</div>
                    <div class="cart-actions">
                        <button class="cart-btn close-cart" id="closeCart">Continue Shopping</button>
                        <button class="cart-btn checkout">Checkout</button>
                    </div>
                </div>
            </div>

            <!--  CHECKOUT  MODAL  -->
            <div class="checkout-modal" id="checkoutModal">
                <div class="checkout-content">
                    <h3 class="checkout-title">Checkout</h3>
                    <form id="checkoutForm">
                        <div class="form-group">
                            <label for="customerName">Name</label>
                            <input type="text" id="customerName" name="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="reservationTime">Reservation Time</label>
                            <input type="datetime-local" id="reservationTime" name="reservationTime" required>
                        </div>
                        <div class="form-group">
                            <label for="numberOfPeople">Number of People</label>
                            <input type="number" id="numberOfPeople" name="numberOfPeople" min="1" required>
                        </div>
                        <div class="payment-qr">
                            <h4>Payment Information</h4>
                            <img src="Extra/Payment.jpeg" alt="Payment QR Code" style="width: 100%; height: 100%;">
                            <p>Please complete your payment before submitting the order</p>
                            <div class="form-group">
                                <label for="paymentProof">Upload Payment Screenshot</label>
                                <input type="file" id="paymentProof" name="paymentProof" accept="image/*" required>
                                <small>Upload a screenshot of your payment confirmation</small>
                            </div>
                        </div>
                        <div class="checkout-actions">
                            <button type="button" class="checkout-btn back-to-cart" id="backToCart">Back to Cart</button>
                            <button type="submit" class="checkout-btn confirm-order">Confirm Order</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ====================== SECTION SHELLS  ===================== -->
            <!-- We leave these empty; items are injected from Firestore. -->

            <div class="menu-section">
                <div class="cart-header">
                    <h3>Noodle Dishes</h3>
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                </div>
                <div class="menu-items"></div>
            </div>

            <div class="menu-section">
                <h3>Rice Dishes</h3>
                <div class="menu-items"></div>
            </div>

            <div class="menu-section">
                <h3>Drinks</h3>
                <div class="menu-items"></div>
            </div>

            <div class="menu-section">
                <h3>Snacks</h3>
                <div class="menu-items"></div>
            </div>

            <div class="menu-section">
                <h3>Bread &amp; Toast</h3>
                <div class="menu-items"></div>
            </div>

            <div class="menu-section">
                <h3>Add Ons</h3>
                <div class="menu-items"></div>
            </div>
        </div>
    </section>

    <!-- ===================================================== -->
    <!-- FOOTER -->
    <!-- ===================================================== -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="YuanFong.png" alt="Yuan Fong Restaurant Logo" class="footer-logo-img" style="width: 250px; height: 200px; margin-left: -40px;">
                </div>
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="menu.html">Menu</a></li>
                        <li><a href="blog.html">News & Promotions</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> No.24, Jalan SS4D/14, Ss 4,<br>&nbsp;&nbsp;&nbsp;&nbsp;47301 Petaling Jaya, Selangor</p>
                    <p><i class="fas fa-phone"></i> +60 12-515 0518</p>
                    <p><i class="fas fa-envelope"></i> yuanfongss4@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Yuan Fong Restaurant. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ===================================================== -->
    <!--  FIREBASE + APP SCRIPT  -->
    <!-- ===================================================== -->
    <script type="module">
        /*  -----------------------------------------------------------------
            1️⃣  Replace the placeholders below with your real Firebase config
            2️⃣  Ensure your Firestore has a collection called `menuItems`
                with docs containing: { name, price, type, imageUrl }
            ----------------------------------------------------------------- */
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBagIcddt7BjkYsvC33BqDQfMzsFdjy5D0",
          authDomain: "yuanfong-84448.firebaseapp.com",
          projectId: "yuanfong-84448",
          storageBucket: "yuanfong-84448.firebasestorage.app",
          messagingSenderId: "743419868803",
          appId: "1:743419868803:web:b0c2548633927bd302cdb6",
          measurementId: "G-HCBLT09FXN"
        };

        const app = initializeApp(firebaseConfig);    
        const db = getFirestore(app);

        // --------------------  GLOBALS --------------------
        const cart = [];
        const cartCount = document.getElementById("cartCount");
        const cartIcon = document.getElementById("cartIcon");
        const cartModal = document.getElementById("cartModal");
        const closeCart = document.getElementById("closeCart");
        const cartItems = document.getElementById("cartItems");
        const cartTotal = document.getElementById("cartTotal");
        const successMessage = document.getElementById("successMessage");
        const checkoutModal = document.getElementById("checkoutModal");
        const backToCart = document.getElementById("backToCart");
        const checkoutForm = document.getElementById("checkoutForm");
        const checkoutBtn = document.querySelector(".checkout");

        // --------------------  HELPERS --------------------
        function toast(msg = "Successfully added to cart!") {
            successMessage.textContent = msg;
            successMessage.classList.add("show");
            setTimeout(() => successMessage.classList.remove("show"), 2000);
        }

        function updateCartCount() {
            cartCount.textContent = cart.reduce((sum, i) => sum + i.quantity, 0);
        }

        function updateCartModal() {
            cartItems.innerHTML = "";
            let total = 0;
            if (cart.length === 0) {
                cartItems.innerHTML = "<p>Your cart is empty</p>";
                cartTotal.textContent = "Total: RM0.00";
                return;
            }
            cart.forEach(i => {
                const row = document.createElement("div");
                row.className = "cart-item";
                row.innerHTML = `
                    <div class="cart-item-name">${i.name}</div>
                    <div class="cart-item-quantity">x${i.quantity}</div>
                    <div class="cart-item-price">RM${(i.price * i.quantity).toFixed(2)}</div>
                `;
                cartItems.appendChild(row);
                total += i.price * i.quantity;
            });
            cartTotal.textContent = `Total: RM${total.toFixed(2)}`;
        }

        // --------------------  EVENT LISTENERS --------------------
        document.addEventListener("click", e => {
            // Quantity + / -
            if (e.target.classList.contains("increase") || e.target.classList.contains("decrease")) {
                const qtyEl = e.target.parentElement.querySelector(".quantity");
                let qty = +qtyEl.textContent;
                qty = e.target.classList.contains("increase") ? qty + 1 : Math.max(0, qty - 1);
                qtyEl.textContent = qty;
                const addBtn = e.target.closest(".menu-item").querySelector(".add-to-cart");
                addBtn.disabled = qty === 0;
            }
            // Add‑to‑cart
            if (e.target.classList.contains("add-to-cart")) {
                const itemEl = e.target.closest(".menu-item");
                const name = itemEl.querySelector(".item-name").textContent;
                const price = +itemEl.querySelector(".item-price").textContent.replace("RM", "");
                const qty = +itemEl.querySelector(".quantity").textContent;
                if (qty === 0) return alert("Select at least 1 quantity");
                const existing = cart.find(i => i.name === name);
                existing ? existing.quantity += qty : cart.push({ name, price, quantity: qty });
                itemEl.querySelector(".quantity").textContent = 0;
                e.target.disabled = true;
                updateCartCount();
                toast();
            }
        });

        // Cart modal open/close
        cartIcon.addEventListener("click", () => { updateCartModal(); cartModal.style.display = "flex"; });
        closeCart.addEventListener("click", () => cartModal.style.display = "none");
        cartModal.addEventListener("click", e => { if (e.target === cartModal) cartModal.style.display = "none"; });

        // Checkout flow
        checkoutBtn.addEventListener("click", () => {
            if (cart.length === 0) return alert("Your cart is empty");
            cartModal.style.display = "none";
            checkoutModal.style.display = "flex";
        });
        backToCart.addEventListener("click", () => { checkoutModal.style.display = "none"; cartModal.style.display = "flex"; });
        checkoutModal.addEventListener("click", e => { if (e.target === checkoutModal) checkoutModal.style.display = "none"; });

        checkoutForm.addEventListener("submit", e => {
            e.preventDefault();
            alert("👍 Order submitted! (hook up your API here)");
            checkoutModal.style.display = "none";
            cart.length = 0;
            updateCartCount();
        });

        // --------------------  LOAD MENU FROM FIRESTORE --------------------
        async function loadMenu() {
            try {
                const snap = await getDocs(collection(db, "menuItems"));
                const byType = {};
                snap.forEach(d => {
                    const item = d.data();
                    if (!byType[item.type]) byType[item.type] = [];
                    byType[item.type].push(item);
                });
                // insert into DOM
                Object.entries(byType).forEach(([type, items]) => {
                    const section = Array.from(document.querySelectorAll(".menu-section"))
                        .find(sec => sec.querySelector("h3").textContent.trim() === type);
                    if (!section) return;
                    const container = section.querySelector(".menu-items");
                    items.forEach(it => {
                        const card = document.createElement("div");
                        card.className = "menu-item";
                        card.innerHTML = `
                            <img src="${it.imageUrl}" alt="${it.name}" class="item-img" style="width: 180px;">
                            <div class="item-info">
                                <div class="item-name">${it.name}</div>
                                <div class="item-price">RM${(+it.price).toFixed(2)}</div>
                                <div class="cart-controls">
                                    <div class="quantity-controls">
                                        <button class="decrease">-</button>
                                        <span class="quantity">0</span>
                                        <button class="increase">+</button>
                                    </div>
                                    <button class="add-to-cart" disabled>Add to Cart</button>
                                </div>
                            </div>`;
                        container.appendChild(card);
                    });
                });
            } catch (err) {
                console.error("Failed to load menu items", err);
            }
        }

        // INIT
        loadMenu();
    </script>
</body>

</html>
